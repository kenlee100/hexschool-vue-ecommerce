import{d as c,I as h}from"./index-a352aac4.js";import{a as n}from"./common-10f7587a.js";import{a as p,c as g}from"./cartStore-794f6400.js";import{s as o,t as u}from"./request-a94ccf31.js";const l=(t=1)=>o({url:`/products?page=${t}`,method:"GET"}),d=()=>o({url:"/products/all",method:"GET"}),_=t=>o({url:`/product/${t}`,method:"GET"}),D=c("productData",{state:()=>({searchArea:"",products:[],productsAll:[],modifyData:[],categoryData:[],currentCategory:"",pagination:{per_page:10,totalResult:0,total_pages:0,current_page:1,data:[]}}),actions:{async getProductsAll(){const t=await d();this.productsAll=t.products,this.modifyData=[...this.productsAll],this.setCategory(this.modifyData)},async getProducts(t=1){const a=await l(t);this.products=a.products},async addCart(t,a=1){n().isProcessing=!0;const e=await p({data:{product_id:t.id,qty:a}});n().isProcessing=!1;const{message:s,data:{product:r}}=e,{getCartList:i}=g();await i(),await u.fire({icon:"success",title:`${r.title} ${s}`})},setCategory(t){const a=new Set;t.forEach(e=>{this.categoryData=[...a.add(e.category)]})},changeCategory(t){this.searchArea="",this.currentCategory=t,this.changeQuery(t),this.filterData(t)},filterData(t){let a=[],e=[];e=this.searchArea.toLowerCase()===""?this.productsAll:this.productsAll.filter(s=>this.filterText(s.title,this.searchArea)||this.filterText(s.category,this.searchArea)),a=t==="全部地區"?this.productsAll:this.productsAll.filter(s=>s.category===t),this.searchArea.toLowerCase()!==""?this.modifyData=e:t!==""&&(this.modifyData=a)},searchCategory(t){this.currentCategory="",t===""?(this.currentCategory="全部地區",this.modifyData=this.productsAll,this.changeQuery(this.currentCategory)):this.categoryData.includes(t)?this.changeCategory(t):(this.filterData(t),this.changeQuery(t))},changeQuery(t){h.push(`/products?category=${t}`),this.pagination.current_page=1},pageNum(){this.pagination.totalResult=this.modifyData.length,this.pagination.total_pages=Math.ceil(this.pagination.totalResult/this.pagination.per_page),this.pagination.current_page>this.pagination.total_pages&&(this.pagination.current_page=this.pagination.total_pages),this.pagination.current_page<=1&&(this.pagination.current_page=1)},filterText(t,a){if(t)return t.toLowerCase().includes(a.toLowerCase())}},getters:{paginationData(){this.pageNum();const t=this.pagination.current_page*this.pagination.per_page-this.pagination.per_page+1,a=this.pagination.current_page*this.pagination.per_page;let e=[];return this.modifyData.forEach((s,r)=>{let i=r+1;i>=t&&i<=a&&e.push(s)}),{...this.pagination,data:e}}}});export{_ as g,D as p};
