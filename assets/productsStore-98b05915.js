import{d as g,I as n,J as l}from"./index-8dc51b0a.js";import{a as s}from"./common-0df46e94.js";import{c as u}from"./cartStore-b76d7477.js";import{t as r}from"./toast-7bff71d1.js";const{VITE_URL:c,VITE_PATH:p}={VITE_PATH:"ken100",VITE_URL:"https://vue3-course-api.hexschool.io/v2",BASE_URL:"/hexschool-vue-ecommerce",MODE:"production",DEV:!1,PROD:!0,SSR:!1},_=g("productData",{state:()=>({searchArea:"",products:[],productsAll:[],modifyData:[],categoryData:[],currentCategory:"",pagination:{per_page:10,totalResult:0,total_pages:0,current_page:1,data:[]}}),actions:{async getProductsAll(){try{const t=await n.get(`${c}/api/${p}/products/all`);this.productsAll=t.data.products,this.modifyData=[...this.productsAll],this.setCategory(this.modifyData),s().isLoading=!1}catch(t){s().isLoading=!1,r.fire({icon:"error",title:`${t.response.data.message}`})}},async getProducts(t=1){try{const a=await n.get(`${c}/api/${p}/products?page=${t}`);this.products=a.data.products,s().isLoading=!1}catch(a){s().isLoading=!1,r.fire({icon:"error",title:`${a.response.data.message}`})}},async addCart(t,a=1){s().isProcessing=!0,await n.post(`${c}/api/${p}/cart`,{data:{product_id:t.id,qty:a}}).then(e=>{s().isProcessing=!1;const{message:i,data:{product:h}}=e.data,{getCartList:o}=u();o(),r.fire({icon:"success",title:`${h.title} ${i}`})}).catch(e=>{s().isLoading=!1,r.fire({icon:"error",title:`${e.response.data.message}`})})},async getProductItem(t){try{return await n.get(`${c}/api/${p}/product/${t}`)}catch(a){s().isLoading=!1,r.fire({icon:"error",title:`${a.response.data.message}`})}},setCategory(t){const a=new Set;t.forEach(e=>{this.categoryData=[...a.add(e.category)]})},changeCategory(t){this.searchArea="",this.currentCategory=t,this.changeQuery(t),this.filterData(t)},filterData(t){let a=[],e=[];e=this.searchArea.toLowerCase()===""?this.productsAll:this.productsAll.filter(i=>this.filterText(i.title,this.searchArea)||this.filterText(i.category,this.searchArea)),a=t==="全部地區"?this.productsAll:this.productsAll.filter(i=>i.category===t),this.searchArea.toLowerCase()!==""?this.modifyData=e:t!==""&&(this.modifyData=a)},searchCategory(t){this.currentCategory="",t===""?(this.currentCategory="全部地區",this.modifyData=this.productsAll,this.changeQuery(this.currentCategory)):this.categoryData.includes(t)?this.changeCategory(t):(this.filterData(t),this.changeQuery(t))},changeQuery(t){l.push(`/products?category=${t}`),this.pagination.current_page=1},pageNum(){this.pagination.totalResult=this.modifyData.length,this.pagination.total_pages=Math.ceil(this.pagination.totalResult/this.pagination.per_page),this.pagination.current_page>this.pagination.total_pages&&(this.pagination.current_page=this.pagination.total_pages),this.pagination.current_page<=1&&(this.pagination.current_page=1)},filterText(t,a){if(t)return t.toLowerCase().includes(a.toLowerCase())}},getters:{paginationData(){this.pageNum();const t=this.pagination.current_page*this.pagination.per_page-this.pagination.per_page+1,a=this.pagination.current_page*this.pagination.per_page;let e=[];return this.modifyData.forEach((i,h)=>{let o=h+1;o>=t&&o<=a&&e.push(i)}),{...this.pagination,data:e}}}});export{_ as p};
